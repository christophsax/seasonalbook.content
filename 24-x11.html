<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.336">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="James Livsey and Christoph Sax">
<title>Seasonal Adjustment in R - 6&nbsp; X-11</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./25-seats.html" rel="next">
<link href="./23-regARIMA.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><meta name="robots" content="noindex">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
.tag {
    display: inline-block;
    padding: 0.2em 0.4em;
    margin-right: 0.5em;
    font-size: 0.85em;
    color: white;
    border-radius: 0.25em;
}

.tag-case-study {
    background-color: green;
}

.tag-frequency {
    background-color: orange;
}

.tag-fundamentals {
    background-color: blue;
}

.tag-exercises {
    background-color: grey;
}



</style>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script><script src="site_libs/quarto-diagram/mermaid-init.js"></script><link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./20-part-basics.html">Basics</a></li><li class="breadcrumb-item"><a href="./24-x11.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">X-11</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Seasonal Adjustment in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/christophsax/seasonalbook.content" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./20-part-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The fundamentals of X-13</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-regARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">regARIMA Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-x11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">X-11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-seats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">SEATS</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./30-part-data-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-holidays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Irregular holidays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32-trading-days.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Trading days</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33-outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Outliers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34-seasonal-breaks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Seasonal breaks</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./40-part-other-issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other Issues</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41-presence-of-seasonality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Presence of seasonality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42-annual-constraining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Annual constraining</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./43-indirect-vs-direct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Indirect vs direct adjustment</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./50-part-quality-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quality assessment</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./51-quality-measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Quality measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52-revisions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Revisions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#basics" id="toc-basics" class="nav-link active" data-scroll-target="#basics"><span class="header-section-number">6.1</span> Basics</a></li>
  <li><a href="#a-simple-decomposition" id="toc-a-simple-decomposition" class="nav-link" data-scroll-target="#a-simple-decomposition"><span class="header-section-number">6.2</span> A Simple Decomposition</a></li>
  <li><a href="#linear-filters" id="toc-linear-filters" class="nav-link" data-scroll-target="#linear-filters"><span class="header-section-number">6.3</span> Linear Filters</a></li>
  <li><a href="#x-11-filters" id="toc-x-11-filters" class="nav-link" data-scroll-target="#x-11-filters"><span class="header-section-number">6.4</span> X-11 Filters</a></li>
  <li><a href="#extreme-value" id="toc-extreme-value" class="nav-link" data-scroll-target="#extreme-value"><span class="header-section-number">6.5</span> Extreme value</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">6.6</span> Exercises</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/christophsax/seasonalbook.content/edit/main/24-x11.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/christophsax/seasonalbook.content/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-x11" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">X-11</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><!--
-   How to use the X11 spec

-   Case Study: Changing the length of trend and/or seasonal filter

 --><p>As discussed in <a href="22-transform.html#sec-additive-and-multiplicative-adjustment"><span>Section&nbsp;4.1</span></a>, the primary objective of seasonal adjustment is to break down a time series into its trend, seasonal, and irregular components. X-13 provides two methods for this task: X-11 and SEATS. Both methods estimate these components by applying moving average filters to the series.</p>
<p>In this chapter, we will focus on the X-11 method, a non-parametric procedure that utilizes predefined moving-average filters on the data. SEATS, which will be covered in <a href="25-seats.html"><span>Chapter&nbsp;7</span></a>, derives its filters from the underlying ARIMA model.</p>
<section id="basics" class="level2 page-columns page-full" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="basics">
<span class="header-section-number">6.1</span> Basics</h2>
<p>Here, we describe the basic idea behind the seasonal decomposition in X-11. To perform a seasonal adjustment in R, you can use the following code:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">seas</span><span class="op">(</span><span class="va">AirPassengers</span>, x11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = AirPassengers, x11 = list())</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Weekday           -0.0029497  0.0005232  -5.638 1.72e-08 ***</span></span>
<span><span class="co">#&gt; Easter[1]          0.0177674  0.0071580   2.482   0.0131 *  </span></span>
<span><span class="co">#&gt; AO1951.May         0.1001558  0.0204387   4.900 9.57e-07 ***</span></span>
<span><span class="co">#&gt; MA-Nonseasonal-01  0.1156204  0.0858588   1.347   0.1781    </span></span>
<span><span class="co">#&gt; MA-Seasonal-12     0.4973600  0.0774677   6.420 1.36e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (0 1 1)(0 1 1)  Obs.: 144  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 947.3, BIC: 963.9  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 26.65   Shapiro (normality): 0.9908  </span></span>
<span><span class="co">#&gt; Messages generated by X-13:</span></span>
<span><span class="co">#&gt; Warnings:</span></span>
<span><span class="co">#&gt; - Visually significant seasonal and trading day peaks have</span></span>
<span><span class="co">#&gt;   been found in one or more of the estimated spectra.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we have seen in <a href="21-overview.html"><span>Chapter&nbsp;3</span></a>, by providing an empty list, the default SEATS spec is overwritten and X-11 is activated. The line ‘X11 adj.’ in the summary indicates the use of X-11.</p>
<p>X-11 utilizes predefined moving-average filters on the data. It first estimates a trend and a seasonal component, while ensuring unbiased results at the series’ margins. It also uses extreme value correction to for more robust results.</p>
<section id="trend-component" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="trend-component">Trend component</h4>
<p>Estimating the trend component is the first step of an X-11 decomposition. The trend component is estimated by applying a symmetric moving average over the series. Each point in time is averaged using a set number of observations to the left and right of the series. Because the window is symmetric, we need the series to be extended by forecasts and backcasts.</p>
<p>Once the trend component is computed, we can subtract it from the original series to compute a <em>de-trended series</em>.</p>
</section><section id="seasonal-component" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="seasonal-component">Seasonal component</h4>
<p>To estimate the seasonal component, a seasonal filter is applied to the de-trended series. A seasonal filter is a symmetric moving average that is calculated by taking the mean of the same period across several years. For instance, the average for January would be computed using all the January values from the time series data, February would use all February values, and so on.</p>
<!--
    FIXME

    More formally, the seasonal filter can be expressed as follows:

 -->
</section><section id="avoid-biases" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="avoid-biases">Avoid biases</h4>
<p>To ensure unbiased results at the series’ margins, forecasts from the regARIMA model (<a href="23-regARIMA.html"><span>Chapter&nbsp;5</span></a>) are used to extend the series. The regARIMA model also serves as the foundation of the initial steps in the X-11 algorithm to remove outliers and other regression effects before application of moving-averages.</p>
</section><section id="extreme-values" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="extreme-values">Extreme Values</h4>
<p>The X-11 method is sensitive to outliers. To correct for these, X-11 applies a specialized extreme value correction. This procedure identifies extreme values and replaces them. This results in a robust procedure that can automatically choose filters and identify extreme values without much user intervention.</p>
</section><section id="go-in-circles" class="level4 unnumbered page-columns page-full"><h4 class="unnumbered anchored" data-anchor-id="go-in-circles">Go in circles</h4>
<p>X-11 iteratively refines this process. Each iteration enhances the estimated components by selecting more appropriate filters and managing outliers and regression effects.</p>
<p>In the default adjustment from above, a decomposition is run 3 times along with a pre-processing step to fit the regARIMA model. This procedure can be seen in great detail in <span class="citation" data-cites="ladiray12">Ladiray and Quenneville (<a href="#ref-ladiray12" role="doc-biblioref">2012</a>)</span>. The overview of each step:</p>
<div class="no-row-height column-margin column-container"><div id="ref-ladiray12" class="csl-entry" role="listitem">
Ladiray, Dominique, and Benoit Quenneville. 2012. <em>Seasonal Adjustment with the x-11 Method</em>. Vol. 158. Springer Science &amp; Business Media.
</div></div><dl>
<dt>Part A</dt>
<dd>
<p>Prior adjustments including regARIMA modeling of outliers, trading day and moving holiday effects.</p>
</dd>
<dt>Part B</dt>
<dd>
<p>First application of seasonal decomposition. Calculate initial extreme value weights.</p>
</dd>
<dt>Part C</dt>
<dd>
<p>Second estimation of seasonal and trend. Final estimation of extreme value weights.</p>
</dd>
<dt>Part D</dt>
<dd>
<p>Final estimation of seasonally adjusted series, seasonal factors, trend, irregular. Combined factors incorporate the trading day and moving holiday regression effects estimated in Part A</p>
</dd>
</dl></section></section><section id="a-simple-decomposition" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="a-simple-decomposition">
<span class="header-section-number">6.2</span> A Simple Decomposition</h2>
<p><span class="tag tag-fundamentals"><i class="fas fa-registered"></i> Fundamentals</span></p>
<p>To deepen our understanding of the X-11 method, we begin with a manual approach in R. As a basic trend filter, we use a 2x12 moving average. The weights for this filter are distributed as follows: 1/24 for the first and last points, and 1/12 for each of the 11 points in between. We apply these weights to estimate the trend of the <code>AirPassengers</code> series:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="va">AirPassengers</span></span>
<span><span class="va">filter_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">24</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">12</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">observed</span>, filter <span class="op">=</span> <span class="va">filter_trend</span>, sides <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="va">observed</span>, <span class="va">trend</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/x11-trend-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>After obtaining the trend, we estimate the seasonal component of the de-trended series using a 3x3 seasonal filter with weights (1,2,3,2,1)/9, applied consistently across the same season:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">detrended</span> <span class="op">&lt;-</span> <span class="va">observed</span> <span class="op">-</span> <span class="va">trend</span></span>
<span><span class="va">filter_seas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">9</span></span>
<span><span class="va">seasonal</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">detrended</span>, filter <span class="op">=</span> <span class="va">filter_seas</span>, sides <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="va">detrended</span>, <span class="va">seasonal</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/x11-seasonal-component-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Subtracting this seasonal estimate provides us with a rudimentary seasonal adjustment:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adjusted</span> <span class="op">&lt;-</span> <span class="va">observed</span> <span class="op">-</span> <span class="va">seasonal</span></span>
<span><span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="va">observed</span>, <span class="va">adjusted</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/x11-seasonal-adj-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>While this basic adjustment is insightful, it also reveals limitations, particularly at the series ends, underscoring the necessity for regARIMA modeling to extend forecasts. Another challenge is the interplay between trend and seasonality estimation—accurately estimating one in the presence of the other is complex.</p>
<p>These observations pave the way for the X-11 method, which iteratively refines this process. Each iteration enhances the estimated components by selecting more appropriate filters and managing outliers and regression effects.</p>
<!--
During these steps the trend filter is automatically chosen based the noise-to-signal ratios, labeled I/C in the output file.
The seasonal moving average is determined by the Global Moving Seasonality Ratio (GMSR).
Being able to understand the

When using the x11 spec you can change the length of the filter used for the trend and seasonal components with the `trendma` and `seasonalma` arguments respectively.
Additionally, `sigmalim` will control the amount of extreme value adjustment that is done during the seasonal adjustment.
 -->
</section><section id="linear-filters" class="level2 page-columns page-full" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="linear-filters">
<span class="header-section-number">6.3</span> Linear Filters</h2>
<p><span class="tag tag-frequency"><i class="fas fa-wave-square"></i> Frequency Domain</span></p>
<p>Time series analysis in the frequency domain offers a valuable perspective for understanding the behavior of time series data. If you are not familiar with the frequency domain, you may skip these sections.</p>
<p>For those interested, the frequency domain representation enhances the comprehension of how a linear filter affects a time series. Since both X-11 and SEATS utilize linear filters, this insight will deepen the understanding of whichever seasonal adjustment procedure is chosen.</p>
<p>Seasonal adjustment is highly motivated by the study, estimation, and ultimately removal of regular fluctuations in a time series. The words <em>regular fluctuations</em> immediately lead us to trigonometric functions sine and cosine. It turns out, there exist two equivalent representations of a time series. The first, and usually easier for beginners to understand, is the time domain representation. This is expressing how <span class="math inline">\(X_t\)</span> evolves as time <span class="math inline">\(t\)</span> evolves. For example, an MA(1) time domain representation:</p>
<p><span class="math display">\[X_t = w_t + \theta w_{t-1}\]</span></p>
<p>The second, is a frequency domain representation of a series. Here, <span class="math inline">\(X_t\)</span> is represented as the sum of trigonometric functions. More specifically, the spectral density of <span class="math inline">\(X_t\)</span> is the fourier transform of the acf of the series. <span class="math display">\[f_X(\nu) = \sum_{h = - \infty}^{\infty} \gamma(h) e^{-2\pi i \nu h}\]</span> For example, the spectral density of an MA(1) is: <span class="math display">\[f_X(\nu) = \sigma^2 \left( 1 + \theta^2 + 2\theta\cos(2\pi\nu) \right)\]</span></p>
<p>The important concept here is to understand that these representations are equivalent; meaning, they contain the same information about a time series, such as encoding the ACF function.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where does the term “White Noise” come from?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The spectral density of an uncorrelated sequence with variance <span class="math inline">\(\sigma^2\)</span> is simply <span class="math inline">\(f(\nu) = \sigma^2\)</span>. Notice this is not a function of any frequencies, but just a constant for any <span class="math inline">\(\nu\)</span>. Hence, it is a stochastic process that equally weights all frequencies in the spectrum. This is precisely where the name white noise comes from, as white light has the same property of reflecting all color bands equally, combining to produce white light.</p>
</div>
</div>
<p>Now that we know we can express a time series either in the time domain or as a sum of sin and cosine curves, we get to the important part for seasonal adjustment - how does a linear filter effect the input series? Assume we want to pass a moving-average linear filter over our data <span class="math inline">\(X_t\)</span> with weights <span class="math inline">\(\ldots, w_{-2}, w_{-1}, w_{0}, w_{1}, w_{2}, \ldots\)</span>. Assume the output of the linear filter will be <span class="math inline">\(Y_t\)</span> such that <span class="math display">\[Y_t = \sum_{j = -\infty}^{\infty} w_j X_{t+j} =
\ldots + w_{-2}X_{t-2} + w_{-1}X_{t-1} +  w_{0}X_{t} + w_{1}X_{t+1} + w_{2}X_{t+2} + \ldots\]</span> This type of linear filter can be expressed as a linear operator in terms of the backshift operator <span class="math inline">\(B\)</span> , where <span class="math inline">\(BX_t = X_{t-1}\)</span> and <span class="math inline">\(B^{-1}X_t = X_{t+1}\)</span>. <span class="math display">\[W(B) = \ldots + w_{-2}B^2 + w_{-1}B +  w_{0} + w_{1}B^{-1} + w_{2}B^{-2} + \ldots\]</span> and hence <span class="math inline">\(Y_t = W(B)X_t\)</span>. We can now express the spectral density of <span class="math inline">\(Y_t\)</span> in terms of the input spectral density <span class="math inline">\(X_t\)</span>. <span class="math display">\[f_Y(\nu) = \underbrace{\lvert W(e^{2\pi i \nu}) \rvert^2}_{\text{Square Gain Function}} f_X(\nu)\]</span></p>
<p>There is some mathematical machinery needed when understanding exactly what the square-gain function, <span class="math inline">\(\lvert W(e^{2\pi i \nu}) \rvert^2\)</span>, is. However, for the sake of this text we just know that it tells us exactly the frequencies of <span class="math inline">\(X_t\)</span> that amplified in the output <span class="math inline">\(Y_t\)</span> as well as the frequencies of <span class="math inline">\(X_t\)</span> that will be annihilated (when the square-gain function equals 0).</p>
<p>Let’s look at an example spectrum for the airline model. Instead of deriving the result, the following code simulates observations from an airline model with <span class="math inline">\(\theta = .5\)</span> and <span class="math inline">\(\Theta = .9\)</span>. The spectrum is then estimated using a parametric estimator using the <code>spec.ar</code> function. Details of this estimation can be found in <span class="citation" data-cites="brockwell1991theory">Brockwell and Davis (<a href="#ref-brockwell1991theory" role="doc-biblioref">1991</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-brockwell1991theory" class="csl-entry" role="listitem">
Brockwell, Peter J., and Richard A. Davis. 1991. <em>Time Series: Theory and Methods</em>. New York: Springer-Verlag.
</div></div><div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/">forecast</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'quantmod':</span></span>
<span><span class="co">#&gt;   method            from</span></span>
<span><span class="co">#&gt;   as.zoo.data.frame zoo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/Arima.html">Arima</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>,freq<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>               order<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>               seasonal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>               fixed<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>theta<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span>, Theta<span class="op">=</span><span class="op">-</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model</span>, nsim<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/spec.ar.html">spec.ar</a></span><span class="op">(</span><span class="va">x</span>, order <span class="op">=</span> <span class="fl">36</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pass a trend filter over data</span></span>
<span><span class="va">x_trend</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">x</span>, filter <span class="op">=</span> <span class="va">filter_trend</span>, sides <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">fx_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/spec.ar.html">spec.ar</a></span><span class="op">(</span><span class="va">x_trend</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove trend to leave seasonal + irregular</span></span>
<span><span class="va">x_seasonal</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="va">x_trend</span></span>
<span><span class="va">fx_seasonal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/spec.ar.html">spec.ar</a></span><span class="op">(</span><span class="va">x_seasonal</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="864"></p>
</div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="864"></p>
</div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid" width="864"></p>
</div>
</div>
</section><section id="x-11-filters" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="x-11-filters">
<span class="header-section-number">6.4</span> X-11 Filters</h2>
<p>In the X-11 method, the choice of moving average filters plays a crucial role in seasonal adjustment. Users have the flexibility to select the length of both the trend and seasonal moving average filters, impacting the stability and responsiveness of the seasonal component. For example, the following model uses a short <code>3x1</code> filter to identify the seasonal component:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_short</span> <span class="op">&lt;-</span> <span class="fu">seas</span><span class="op">(</span><span class="va">AirPassengers</span>, x11.seasonalma <span class="op">=</span> <span class="st">"s3x1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m_short</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>On the other hand, the following uses a long <code>3x9</code> filter:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_long</span> <span class="op">&lt;-</span> <span class="fu">seas</span><span class="op">(</span><span class="va">AirPassengers</span>, x11.seasonalma <span class="op">=</span> <span class="st">"s3x9"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m_long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Generally speaking, longer filters imply a more stable seasonal component and shorter filters a more changing seasonal pattern. We can see this by comparing the <code><a href="https://rdrr.io/r/stats/monthplot.html">monthplot()</a></code> outputs of the estimations.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/monthplot.html">monthplot</a></span><span class="op">(</span><span class="va">m_short</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>As you can see, the seasonal component is smoother with the longer filter:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/monthplot.html">monthplot</a></span><span class="op">(</span><span class="va">m_long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Longer filters involve more data points in the calculation of the seasonal component at each time point. Therefore, they typically result in smaller revisions when new data is added to the series. However, these revisions can impact historical data values further back in the time series.</p>
<p>In contrast, shorter filters, which use fewer data points, are more likely to produce larger revisions with each new data addition. These revisions, while more significant, extend less far back into the historical data.</p>
<p>If a user does not select a filter, the X-11 method defaults to automatic filter selection. To understand the implications of filter length, consider the finite set of options available during an X-11 adjustment. <a href="#tbl-x11-filters">Table&nbsp;<span>6.1</span></a> details the different filters that can be applied to both the seasonal and trend components of the series.</p>
<div id="tbl-x11-filters" class="anchored">
<table class="table">
<caption>Table&nbsp;6.1: Filters available in X11</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<thead><tr class="header">
<th>Value</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>s3x1</code></td>
<td>3×1 moving average</td>
</tr>
<tr class="even">
<td><code>s3x3</code></td>
<td>3×3 moving average</td>
</tr>
<tr class="odd">
<td><code>s3x5</code></td>
<td>3×5 moving average</td>
</tr>
<tr class="even">
<td><code>s3x9</code></td>
<td>3×9 moving average</td>
</tr>
<tr class="odd">
<td><code>s3x15</code></td>
<td>3×15 moving average</td>
</tr>
<tr class="even">
<td><code>stable</code></td>
<td>Stable seasonal filter. A single seasonal factor for each calendar month or quarter is generated by calculating the simple average of all the values for each month or quarter (taken after de-trending and outlier adjustment).</td>
</tr>
<tr class="odd">
<td><code>x11default</code></td>
<td>A 3×3 moving average is used to calculate the initial seasonal factors in each iteration, and a 3×5 moving average to calculate the final seasonal factors.</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section><section id="extreme-value" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="extreme-value">
<span class="header-section-number">6.5</span> Extreme value</h2>
<p>As mentioned above, X-11 is sensitive to outliers, and applies its own extreme value adjustment (see the box for the differences between outliers and extreme values).</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Outliers and Extreme values
</div>
</div>
<div class="callout-body-container callout-body">
<p>The terms outlier and extreme value seem interchangeable. In X-13, these refer to very different types of effects. An outlier is identified by the regARIMA model in Part A (see below) of the X-11 method. An extreme value is a value that is large enough to effect the results of a moving-average filter but is not identified by the regARIMA automatic modeling identification. Outliers are prior-adjusted out of the series, while extreme values are replaced within the X-11 procedure.</p>
<p>Both types end up in the seasonally adjusted series. Extreme values are assigned to the irregular component and are hence included in the seasonally adjusted series. Outliers get included in Part D (see below) when X-11 calculates the final seasonal factors using the original series including outlier effects.</p>
<p>We will discuss extreme values and outliers in more detail in <a href="33-outliers.html"><span>Chapter&nbsp;10</span></a>.</p>
</div>
</div>
<p>In the X-11 method, along with the regressors defined in the regARIMA model (such as additive outliers or level shifts), there’s a distinct process for adjusting extreme values. After an initial trend estimation, X-11 replaces extreme values according to the following procedure:</p>
<div class="cell" data-fig-width="9">
<div class="cell-output-display">
<div id="fig-spec-interaction" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div>
<pre class="mermaid mermaid-js" data-label="fig-spec-interaction">flowchart LR
    A(Estimate standard deviation &lt;br&gt; of irregular, sigma)--&gt;B(Compare values to &lt;br&gt; multiples of sigma)
    B--&gt;C(value smaller than 1.5 sigma)
    B--&gt;D(value between 1.5 and 2.5 sigma)
    B--&gt;E(value larger than 2.5 * sigma)
    C --&gt; F(value unchanged)
    D --&gt; G(value linearly weighted)
    E --&gt; H(value fully weighted)
</pre>
</div>
<figcaption class="figure-caption">Figure&nbsp;6.1: Default behavior of extreme value replacement procedure.</figcaption></figure>
</div>
</div>
</div>
<p>De-trended values (in X-13 parlance, they are sometimes called <em>SI-ratios</em>) are replaced with an average of the two nearest values from the same period. E.g., if January 1958 is considered to be an extreme value, the values of January 1956, 1957, 1959 and 1960 will be used.</p>
<p>If a values is larger than the larger limit, it is fully replaced. If a value is smaller than the lower limit, it is not replaced. If a value lies between the limits, it a weighted average between the two surrounding values and the value itself is used.</p>
<p>Note, that only non-replaced values are used to derive the replacement values. Hence, if a very small limit is used, the values that are used to derive the replacement values may be far way.</p>
<p>Users can modify the sigma thresholds (<code>sigmalim</code>) for extreme value conversion within the X-11 specification. Choosing smaller values lead to more extreme values and should typically result in a smoother seasonal component. This option, defined as a two-length vector that specifies when weighting should begin and when full weight of zero should be applied. Between the endpoints of the specified vector, a linear weight will be applied.</p>
<p>Extreme value choices can significantly influence the seasonal adjustment outcome. For example, the default values for in <code>AirPassengers</code> adjustment look as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">seas</span><span class="op">(</span><span class="va">AirPassengers</span>, x11 <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">unmodified_SIratio</span> <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m</span>, <span class="st">"d8"</span><span class="op">)</span></span>
<span><span class="va">modified_SIratio</span>   <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m</span>, <span class="st">"d9"</span><span class="op">)</span></span>
<span><span class="va">seasonal_factors</span> <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m</span>, <span class="st">"d10"</span><span class="op">)</span></span>
<span><span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">unmodified_SIratio</span>, <span class="va">modified_SIratio</span>, <span class="va">seasonal_factors</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>An alternative way to inspect output of X-13 is to use the <code>out()</code> function, which accesses the X-13 HTML output that contains a plethora of information:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">out</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we change <code>x11.sigmalim</code> to <code>c(1, 2)</code>, we get the following result:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_small_limits</span> <span class="op">&lt;-</span> <span class="fu">seas</span><span class="op">(</span><span class="va">AirPassengers</span>, x11 <span class="op">=</span> <span class="st">""</span>, x11.sigmalim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">unmodified_SIratio</span> <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m_small_limits</span>, <span class="st">"d8"</span><span class="op">)</span></span>
<span><span class="va">modified_SIratio</span>   <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m_small_limits</span>, <span class="st">"d9"</span><span class="op">)</span></span>
<span><span class="va">seasonal_factors</span> <span class="op">&lt;-</span> <span class="fu">series</span><span class="op">(</span><span class="va">m_small_limits</span>, <span class="st">"d10"</span><span class="op">)</span></span>
<span><span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">unmodified_SIratio</span>, <span class="va">modified_SIratio</span>, <span class="va">seasonal_factors</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="24-x11_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<!--

FIMXE why does X-11 needs it's own log mode?

## Additive and multiplicative (again)

The X-13ARIMA-SEATS development was highly motivated to study economic time series.
As such, the default seasonal adjustment mode is multiplicative due to most seasonal economic time series displaying seasonal fluctuations that increase and decrease along with the level of the time series.

If your series does not have this feature then additive adjustment might be more appropriate.
This can be changed in the `mode` argument of the x11 spec.
For example, `seas(x, x11.mode = 'add')` will perform an additive x11 run.
There exist two other models for decomposition, pseudo-additive and log additive.
These are less common than additive and multiplicative models and are not the focus of this text.
If your series has some extremely small values in certain months (quarters) then pseudo-additive models could be worth further investigation.
It has been observed that when multiplicative seasonal adjustment produces more extreme values in conjunction with small seasonal factors then pseudo-additive adjustment should be explored.
 -->

<!-- NEED TO SHOW USERS HOW TO VIEW THEIR EXTREME VALUES - D8.B TABLE DESIGNATIONS NEXT TO OBSERVATIONS. A good reference on the subject is Baxter (1994). -->
</section><section id="exercises" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">6.6</span> Exercises</h2>
<p><span class="tag tag-exercises"><i class="fas fa-shoe-prints"></i> Exercises</span></p>
<ol type="1">
<li>
<p><strong>Performing an Automated Seasonal Adjustment with X-11:</strong></p>
<ul>
<li>Use the <code>seasonal</code> package to perform an automated seasonal adjustment on the <code>fdeaths</code> dataset using the X-11 method.</li>
<li>Plot the results and summarize the key components of the model.</li>
</ul>
</li>
<li>
<p><strong>Inspecting the Seasonal Component with <code><a href="https://rdrr.io/r/stats/monthplot.html">monthplot()</a></code>:</strong></p>
<ul>
<li>Use the <code><a href="https://rdrr.io/r/stats/monthplot.html">monthplot()</a></code> function to inspect the seasonal component of the adjusted <code>fdeaths</code> series.</li>
<li>Describe the observed seasonal pattern.</li>
</ul>
</li>
<li>
<p><strong>Adjusting Filter Length:</strong></p>
<ul>
<li>Adjust the seasonal filter length to a longer filter (<code>s3x15</code>) for the <code>fdeaths</code> dataset.</li>
<li>Use the <code><a href="https://rdrr.io/r/stats/monthplot.html">monthplot()</a></code> function to compare the seasonal components between the default and longer filter.</li>
<li>Describe the differences observed.</li>
</ul>
</li>
<li>
<p><strong>Inspecting Extreme Value Adjustment:</strong></p>
<ul>
<li>Use the <code>out()</code> function to inspect the extreme value adjustment for the <code>fdeaths</code> dataset.</li>
<li>Identify the default values for <code>sigmalim</code> used in the adjustment.</li>
</ul>
</li>
<li>
<p><strong>Modifying <code>sigmalim</code> Values:</strong></p>
<ul>
<li>Change the <code>sigmalim</code> values to lower thresholds for the <code>fdeaths</code> dataset.</li>
<li>Plot the results and use the <code><a href="https://rdrr.io/r/stats/monthplot.html">monthplot()</a></code> function to see if the changes affect the seasonal component.</li>
<li>Describe any differences observed.</li>
</ul>
</li>
</ol>
<!--
## Case study

tsbox::ts_plot(
  s3x1 = predict(seas(AirPassengers, x11.seasonalma = "s3x1")),
  s3x15 = predict(seas(AirPassengers, x11.seasonalma = "s3x15"))
)

 --><!--

## Points to include in Chapter

-   Level shifts are included with the trend component, while AOs and extreme values are included in the irregular.
-   Changing filters can affect which values are extreme
-   Changing sigma limits changes the extreme values and can affect what filter seems most appropriate
    -   Experiment with changing filters and sigma limits for your series to see the results
 -->


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./23-regARIMA.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">regARIMA Model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./25-seats.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">SEATS</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">by James Livsey and Christoph Sax</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Seasonal Adjustment in R</div>
  </div>
</footer>


</body></html>