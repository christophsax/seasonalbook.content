<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.336">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="James Livsey and Christoph Sax">
<title>Seasonal Adjustment in R - 11&nbsp; Seasonal breaks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./40-part-other-issues.html" rel="next">
<link href="./33-outliers.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><meta name="robots" content="noindex">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./30-part-data-problems.html">Data Problems</a></li><li class="breadcrumb-item"><a href="./34-seasonal-breaks.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Seasonal breaks</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Seasonal Adjustment in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/christophsax/seasonalbook.content" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./20-part-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The fundamentals of X-13</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-regARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">regARIMA Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-x11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">X-11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-seats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">SEATS</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./30-part-data-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-holidays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Irregular holidays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32-trading-days.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Trading days</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33-outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Outliers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34-seasonal-breaks.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Seasonal breaks</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./40-part-other-issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other Issues</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41-presence-of-seasonality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Presence of seasonality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42-annual-constraining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Annual constraining</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./43-indirect-vs-direct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Indirect vs direct adjustment</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./50-part-quality-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quality assessment</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./51-quality-measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Quality measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52-revisions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Revisions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#identifying-a-seasonal-break" id="toc-identifying-a-seasonal-break" class="nav-link active" data-scroll-target="#identifying-a-seasonal-break"><span class="header-section-number">11.1</span> Identifying a seasonal break</a></li>
  <li><a href="#restricting-model-span" id="toc-restricting-model-span" class="nav-link" data-scroll-target="#restricting-model-span"><span class="header-section-number">11.2</span> Restricting model span</a></li>
  <li><a href="#modelling-seasonal-breaks" id="toc-modelling-seasonal-breaks" class="nav-link" data-scroll-target="#modelling-seasonal-breaks"><span class="header-section-number">11.3</span> Modelling seasonal breaks</a></li>
  <li><a href="#when-to-model-a-seasonal-break" id="toc-when-to-model-a-seasonal-break" class="nav-link" data-scroll-target="#when-to-model-a-seasonal-break"><span class="header-section-number">11.4</span> When to model a seasonal break?</a></li>
  <li><a href="#case-study-azerbaijani-budget-expenditures" id="toc-case-study-azerbaijani-budget-expenditures" class="nav-link" data-scroll-target="#case-study-azerbaijani-budget-expenditures"><span class="header-section-number">11.5</span> Case Study: Azerbaijani Budget Expenditures</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/christophsax/seasonalbook.content/edit/main/34-seasonal-breaks.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/christophsax/seasonalbook.content/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-seasonal-breaks" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Seasonal breaks</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><!--
-   Why to care about seasonal breaks?

-   Detection of seasonal breaks

-   Correction for seasonal breaks

 --><p>The goal of seasonal adjustment is to remove repeating seasonal patterns from time series data. These patterns are predictable and can be modeled in an ARIMA model. A <em>seasonal break</em> refers to a sudden change in the seasonal pattern of the data. Such a change could be due to various factors, such as:</p>
<ul>
<li><p>A major economic event that alters consumer behavior or business operations, leading to long-lasting change in the seasonal component.</p></li>
<li><p>A change in policy or regulations that affects the seasonal cycle, such as new holiday schedules or school calendars.</p></li>
<li><p>Shifts in consumer preferences that change the way people interact with products or services throughout the year.</p></li>
<li><p>Changes in how the data is measured or surveyed, e.g, changes in the population being surveyed, or revisions to the methodologies used to gather the data.</p></li>
</ul>
<p>Detecting seasonal breaks is important because they can significantly affect the accuracy of the underlying ARIMA model.</p>
<p>In the case of the SEATS method, the ARIMA model will affect both the ARIMA forecast and the seasonal adjustment.</p>
<p>In case of the X-11 method, the moving averages are capable of dealing with changes in the seasonal pattern. The shorter the filter, the faster they adapt to an altered sesaonal pattern. However, the X-11 method is also susceptible to seasonal breaks, since ARIMA forecast is needed at the margin of the series.</p>
<section id="identifying-a-seasonal-break" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="identifying-a-seasonal-break">
<span class="header-section-number">11.1</span> Identifying a seasonal break</h2>
<p>In a previous case study, we analyzed the imports of goods to China, where we detected a pretty obvious seasonal break.</p>
<p>Chinese imports are included as an example series in seasonal, both with and without the official seasonal adjustment.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tsbox/">tsbox</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"seasonalbook"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"0.0.2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">seasonalbook</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.seasonal.website">seasonal</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="va">imp_cn</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>As can be spotted quickly, the series has a very different seasonal pattern before 2000. In our previous example, we simply cut the data and focused on the later period.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_span.html">ts_span</a></span><span class="op">(</span><span class="va">imp_cn</span>, start <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>The seasonal break is even clearer to spot in the monthplot of the series:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/monthplot.html">monthplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span><span class="va">imp_cn</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>This makes it obvious that there were very strong December effects before 2000. We don’t know anything about the series, but we can speculate that prior to 2000, custom receipts were counted at the end of the year, rather than at the date of import.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="va">imp_cn</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seasonal/2000.1/"</span><span class="op">)</span>,</span>
<span>  regression.aictest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = imp_cn, transform.function = "log", regression.aictest = NULL, </span></span>
<span><span class="co">#&gt;     outlier = NULL, x11 = "", regression.variables = c("seasonal/2000.1/"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Jan               -0.0654535  0.0181009  -3.616 0.000299 ***</span></span>
<span><span class="co">#&gt; Feb               -0.1970206  0.0180950 -10.888  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Mar                0.0356460  0.0181169   1.968 0.049119 *  </span></span>
<span><span class="co">#&gt; Apr                0.0328228  0.0181109   1.812 0.069937 .  </span></span>
<span><span class="co">#&gt; May               -0.0238587  0.0180941  -1.319 0.187307    </span></span>
<span><span class="co">#&gt; Jun                0.0067156  0.0180789   0.371 0.710295    </span></span>
<span><span class="co">#&gt; Jul                0.0354693  0.0180731   1.963 0.049699 *  </span></span>
<span><span class="co">#&gt; Aug                0.0350369  0.0180802   1.938 0.052641 .  </span></span>
<span><span class="co">#&gt; Sep                0.0813043  0.0180989   4.492 7.05e-06 ***</span></span>
<span><span class="co">#&gt; Oct               -0.0441661  0.0181234  -2.437 0.014811 *  </span></span>
<span><span class="co">#&gt; Nov                0.0328833  0.0181436   1.812 0.069926 .  </span></span>
<span><span class="co">#&gt; Jan I             -0.3183942  0.0352764  -9.026  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Feb I             -0.1122450  0.0350760  -3.200 0.001374 ** </span></span>
<span><span class="co">#&gt; Mar I             -0.0295122  0.0350251  -0.843 0.399452    </span></span>
<span><span class="co">#&gt; Apr I             -0.0286242  0.0348917  -0.820 0.412005    </span></span>
<span><span class="co">#&gt; May I              0.0669706  0.0347657   1.926 0.054062 .  </span></span>
<span><span class="co">#&gt; Jun I              0.0165824  0.0347032   0.478 0.632768    </span></span>
<span><span class="co">#&gt; Jul I             -0.0001398  0.0347261  -0.004 0.996788    </span></span>
<span><span class="co">#&gt; Aug I             -0.0354610  0.0348208  -1.018 0.308495    </span></span>
<span><span class="co">#&gt; Sep I             -0.0641267  0.0349392  -1.835 0.066449 .  </span></span>
<span><span class="co">#&gt; Oct I              0.0496035  0.0349988   1.417 0.156398    </span></span>
<span><span class="co">#&gt; Nov I              0.0332059  0.0348833   0.952 0.341142    </span></span>
<span><span class="co">#&gt; Constant           0.0098924  0.0030076   3.289 0.001005 ** </span></span>
<span><span class="co">#&gt; MA-Nonseasonal-01  0.6490499  0.0510055  12.725  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; MA-Nonseasonal-02 -0.1976993  0.0507758  -3.894 9.88e-05 ***</span></span>
<span><span class="co">#&gt; MA-Seasonal-12    -0.2451488  0.0506633  -4.839 1.31e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (0 1 2)(0 0 1)  Obs.: 372  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 1.76e+04, BIC: 1.77e+04  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 25.25   Shapiro (normality): 0.9328 ***</span></span>
<span><span class="co">#&gt; Messages generated by X-13:</span></span>
<span><span class="co">#&gt; Warnings:</span></span>
<span><span class="co">#&gt; - At least one visually significant trading day peak has been</span></span>
<span><span class="co">#&gt;   found in one or more of the estimated spectra.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Notes:</span></span>
<span><span class="co">#&gt; - Stable seasonal regressors present in the regARIMA model.</span></span>
<span><span class="co">#&gt;   Maximum seasonal difference in automatic model</span></span>
<span><span class="co">#&gt;   identification procedure set to zero.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients from the summary are as follows:</p>
<table class="table">
<thead><tr class="header">
<th>Month</th>
<th>Pre 2000 coefficients</th>
<th>Post 2000 coefficients</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Jan</td>
<td>-0.0654535</td>
<td>-0.3183942</td>
</tr>
<tr class="even">
<td>Feb</td>
<td>-0.1970206</td>
<td>-0.1122450</td>
</tr>
<tr class="odd">
<td>Mar</td>
<td>0.0356460</td>
<td>-0.0295122</td>
</tr>
<tr class="even">
<td>Apr</td>
<td>0.0328228</td>
<td>-0.0286242</td>
</tr>
<tr class="odd">
<td>May</td>
<td>-0.0238587</td>
<td>0.0669706</td>
</tr>
<tr class="even">
<td>Jun</td>
<td>0.0067156</td>
<td>0.0165824</td>
</tr>
<tr class="odd">
<td>Jul</td>
<td>0.0354693</td>
<td>-0.0001398</td>
</tr>
<tr class="even">
<td>Aug</td>
<td>0.0350369</td>
<td>-0.0354610</td>
</tr>
<tr class="odd">
<td>Sep</td>
<td>0.0813043</td>
<td>-0.0641267</td>
</tr>
<tr class="even">
<td>Oct</td>
<td>-0.0441661</td>
<td>0.0496035</td>
</tr>
<tr class="odd">
<td>Nov</td>
<td>0.0328833</td>
<td>0.0332059</td>
</tr>
<tr class="even">
<td>Dec (derived)</td>
<td>0.0294782</td>
<td>-0.3710507</td>
</tr>
</tbody>
</table>
<p>We see multiple sign changes and multiple large discrepancies between the two model spans. This is an indication that this series has a change-of-regime. Also as previously indicated the December effect was much different post 2000.</p>
</section><section id="restricting-model-span" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="restricting-model-span">
<span class="header-section-number">11.2</span> Restricting model span</h2>
<p>In many cases, restricting <code>series.modelspan</code> may be the easiest way to deal with such series.</p>
<p>When restricting the model span, we use only part of the series for model estimation, but still applies seasonal adjustment to the whole series. Thus, the ARIMA model is the same as if we cutted the span of the series before adjustment (as we did in the previous case study):</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">m_modelspan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="va">imp_cn</span>,</span>
<span>  series.modelspan <span class="op">=</span> <span class="st">"2000.jan,"</span>,</span>
<span>  x11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m_modelspan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = imp_cn, series.modelspan = "2000.jan,", x11 = list())</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; AO2001.Jan        -0.261726   0.043878  -5.965 2.45e-09 ***</span></span>
<span><span class="co">#&gt; AO2004.Feb         0.218728   0.042608   5.133 2.84e-07 ***</span></span>
<span><span class="co">#&gt; LS2008.Nov        -0.327482   0.047759  -6.857 7.03e-12 ***</span></span>
<span><span class="co">#&gt; AO2009.Jan        -0.280528   0.042369  -6.621 3.56e-11 ***</span></span>
<span><span class="co">#&gt; AO2011.Jan         0.153783   0.042806   3.593 0.000328 ***</span></span>
<span><span class="co">#&gt; AO2012.Jan        -0.169644   0.043482  -3.901 9.56e-05 ***</span></span>
<span><span class="co">#&gt; AO2012.Feb         0.174648   0.043120   4.050 5.11e-05 ***</span></span>
<span><span class="co">#&gt; LS2016.Jan        -0.229816   0.047847  -4.803 1.56e-06 ***</span></span>
<span><span class="co">#&gt; Weekday            0.006700   0.000806   8.313  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; AR-Nonseasonal-01 -0.426105   0.054515  -7.816 5.44e-15 ***</span></span>
<span><span class="co">#&gt; MA-Seasonal-12     0.794516   0.040311  19.710  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (1 1 0)(0 1 1)  Obs.: 372  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 1.258e+04, BIC: 1.262e+04  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 31.39   Shapiro (normality): 0.9949</span></span>
<span></span>
<span><span class="va">m_span</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_span.html">ts_span</a></span><span class="op">(</span><span class="va">imp_cn</span>, <span class="st">"2000-01"</span><span class="op">)</span>,</span>
<span>  x11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m_span</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = ts_span(imp_cn, "2000-01"), x11 = list())</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; AO2001.Jan        -0.261726   0.043878  -5.965 2.45e-09 ***</span></span>
<span><span class="co">#&gt; AO2004.Feb         0.218728   0.042608   5.133 2.84e-07 ***</span></span>
<span><span class="co">#&gt; LS2008.Nov        -0.327482   0.047759  -6.857 7.03e-12 ***</span></span>
<span><span class="co">#&gt; AO2009.Jan        -0.280528   0.042369  -6.621 3.56e-11 ***</span></span>
<span><span class="co">#&gt; AO2011.Jan         0.153783   0.042806   3.593 0.000328 ***</span></span>
<span><span class="co">#&gt; AO2012.Jan        -0.169644   0.043482  -3.901 9.56e-05 ***</span></span>
<span><span class="co">#&gt; AO2012.Feb         0.174648   0.043120   4.050 5.11e-05 ***</span></span>
<span><span class="co">#&gt; LS2016.Jan        -0.229816   0.047847  -4.803 1.56e-06 ***</span></span>
<span><span class="co">#&gt; Weekday            0.006700   0.000806   8.313  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; AR-Nonseasonal-01 -0.426105   0.054515  -7.816 5.44e-15 ***</span></span>
<span><span class="co">#&gt; MA-Seasonal-12     0.794516   0.040311  19.710  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (1 1 0)(0 1 1)  Obs.: 276  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 1.258e+04, BIC: 1.262e+04  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 31.39   Shapiro (normality): 0.9949</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By using the <code>series.modelspan</code>, we restrict the data used in the ARIMA model, but we sill adjust the whole series. This leads to almost the same seasonally adjusted series in the overlapping period (after 2000).</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/final.html">final</a></span><span class="op">(</span><span class="va">m_modelspan</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/final.html">final</a></span><span class="op">(</span><span class="va">m_span</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Note that the ARIMA model that has been chosen is not optimal for the period before 2000. This will affect the backcast of the series, and may lead to slighly sub-optimal results for the first year. Since the interest in the accuracy of the latest data is usually much higher, this seems like a good compromise in many cases.</p>
</section><section id="modelling-seasonal-breaks" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="modelling-seasonal-breaks">
<span class="header-section-number">11.3</span> Modelling seasonal breaks</h2>
<p>A way to ‘model’ seasonal breaks to include seasonal dummies before (and possibly after) the supposed break. A seasonal dummy model can be estimated by an appropriate specification of the <code>regression.variables</code> argument. This is done with a so-called <em>change-of-regime</em> regression variable. There are two types of change-of-regime regressors available: full and partial.</p>
<p>Change of regime regressors are denoted by adding the change date, enclosed in one or two slashes. This designated date divides the series under analysis into two periods: an early span encompassing data prior to the change date, and a late span covering data from this date onwards.</p>
<ul>
<li>Partial change of regime variables are active only within one of these spans, while remaining zero in the other.</li>
<li>Full change of regime variables simultaneously estimate the base regression and the partial change of regime regression for the early span.</li>
</ul>
<table class="table">
<colgroup>
<col style="width: 56%">
<col style="width: 25%">
<col style="width: 18%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Syntax</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Full change of regime regressor</td>
<td><code>reg/date/</code></td>
<td><code>seasonal/2000.jan/</code></td>
</tr>
<tr class="even">
<td>Partial change of regime regressor, zero before change date</td>
<td><code>reg//date/</code></td>
<td><code>seasonal//2000.jan/</code></td>
</tr>
<tr class="odd">
<td>Partial change of regime regressor, zero on and after change date</td>
<td><code>reg/date//</code></td>
<td><code>sesaonal/2000.jan//</code></td>
</tr>
</tbody>
</table>
<p>To model the span after 2000, we can either cut the time series input (as we did in the case study), or use the <code>series.span</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="va">imp_cn</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(0 1 1)"</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="st">"seasonal"</span>,</span>
<span>  series.span <span class="op">=</span> <span class="st">"2000.jan,"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = imp_cn, transform.function = "log", outlier = NULL, </span></span>
<span><span class="co">#&gt;     x11 = "", arima.model = "(0 1 1)", regression.variables = "seasonal", </span></span>
<span><span class="co">#&gt;     series.span = "2000.jan,")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Jan               -0.068265   0.013106  -5.209 1.90e-07 ***</span></span>
<span><span class="co">#&gt; Feb               -0.203522   0.013082 -15.558  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Mar                0.033622   0.013063   2.574  0.01006 *  </span></span>
<span><span class="co">#&gt; Apr                0.033961   0.013048   2.603  0.00925 ** </span></span>
<span><span class="co">#&gt; May               -0.023603   0.013039  -1.810  0.07027 .  </span></span>
<span><span class="co">#&gt; Jun                0.008008   0.013033   0.614  0.53896    </span></span>
<span><span class="co">#&gt; Jul                0.039197   0.013035   3.007  0.00264 ** </span></span>
<span><span class="co">#&gt; Aug                0.035561   0.013041   2.727  0.00640 ** </span></span>
<span><span class="co">#&gt; Sep                0.086085   0.013049   6.597 4.19e-11 ***</span></span>
<span><span class="co">#&gt; Oct               -0.042614   0.013063  -3.262  0.00111 ** </span></span>
<span><span class="co">#&gt; Nov                0.033393   0.013083   2.552  0.01070 *  </span></span>
<span><span class="co">#&gt; Weekday            0.006096   0.001137   5.362 8.24e-08 ***</span></span>
<span><span class="co">#&gt; MA-Nonseasonal-01  0.342034   0.056700   6.032 1.62e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (0 1 1)  Obs.: 276  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 1.326e+04, BIC: 1.33e+04  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 27.61   Shapiro (normality): 0.9556 ***</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to model the span before 2000, the specification looks as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="va">imp_cn</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(0 1 1)"</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="st">"seasonal"</span>,</span>
<span>  series.span <span class="op">=</span> <span class="st">",1999.dec"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = imp_cn, transform.function = "log", outlier = NULL, </span></span>
<span><span class="co">#&gt;     x11 = "", arima.model = "(0 1 1)", regression.variables = "seasonal", </span></span>
<span><span class="co">#&gt;     series.span = ",1999.dec")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Jan               -0.387506   0.033779 -11.472   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Feb               -0.304623   0.033613  -9.063   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Mar               -0.001298   0.033535  -0.039   0.9691    </span></span>
<span><span class="co">#&gt; Apr               -0.007866   0.033531  -0.235   0.8145    </span></span>
<span><span class="co">#&gt; May                0.048099   0.033810   1.423   0.1548    </span></span>
<span><span class="co">#&gt; Jun                0.009728   0.033459   0.291   0.7712    </span></span>
<span><span class="co">#&gt; Jul                0.029471   0.033391   0.883   0.3774    </span></span>
<span><span class="co">#&gt; Aug                0.007545   0.033592   0.225   0.8223    </span></span>
<span><span class="co">#&gt; Sep                0.005823   0.033691   0.173   0.8628    </span></span>
<span><span class="co">#&gt; Oct                0.019756   0.033711   0.586   0.5578    </span></span>
<span><span class="co">#&gt; Nov                0.077857   0.033614   2.316   0.0205 *  </span></span>
<span><span class="co">#&gt; Weekday            0.008259   0.003786   2.182   0.0291 *  </span></span>
<span><span class="co">#&gt; MA-Nonseasonal-01  0.670552   0.072772   9.214   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (0 1 1)  Obs.: 96  Transform: log</span></span>
<span><span class="co">#&gt; AICc:  4264, BIC:  4295  QS (no seasonality in final):6.021 *</span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 45.85 ** Shapiro (normality): 0.9202 ***</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we set <code>outlier</code>, <code>arima.model</code> and <code>transform.function</code> such that we can ensure comparability.</p>
<p>We can use the <code>regression.variables</code> argument to estimate the whole span in one call:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  <span class="va">imp_cn</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(0 1 1)"</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="st">"seasonal/2000.jan//"</span>, </span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = imp_cn, transform.function = "log", outlier = NULL, </span></span>
<span><span class="co">#&gt;     x11 = "", arima.model = "(0 1 1)", regression.variables = "seasonal/2000.jan//")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Jan I             -0.386705   0.034705 -11.143  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Feb I             -0.301462   0.034517  -8.734  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Mar I              0.004075   0.034367   0.119 0.905618    </span></span>
<span><span class="co">#&gt; Apr I             -0.001388   0.034268  -0.040 0.967700    </span></span>
<span><span class="co">#&gt; May I              0.050501   0.034285   1.473 0.140765    </span></span>
<span><span class="co">#&gt; Jun I              0.015335   0.034187   0.449 0.653745    </span></span>
<span><span class="co">#&gt; Jul I              0.033103   0.034199   0.968 0.333078    </span></span>
<span><span class="co">#&gt; Aug I              0.006655   0.034294   0.194 0.846126    </span></span>
<span><span class="co">#&gt; Sep I              0.006256   0.034369   0.182 0.855558    </span></span>
<span><span class="co">#&gt; Oct I              0.012976   0.034397   0.377 0.706007    </span></span>
<span><span class="co">#&gt; Nov I              0.068627   0.034354   1.998 0.045755 *  </span></span>
<span><span class="co">#&gt; Weekday            0.006342   0.001790   3.543 0.000395 ***</span></span>
<span><span class="co">#&gt; MA-Nonseasonal-01  0.559147   0.042527  13.148  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (0 1 1)  Obs.: 372  Transform: log</span></span>
<span><span class="co">#&gt; AICc: 1.779e+04, BIC: 1.785e+04  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 248.8 *** Shapiro (normality): 0.9482 ***</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, seasonal outliers are removed from the final series.</p>
</section><section id="when-to-model-a-seasonal-break" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="when-to-model-a-seasonal-break">
<span class="header-section-number">11.4</span> When to model a seasonal break?</h2>
<p>When should we model a seasonal break? When we have enough data after the break (as in the imports of goods to China example), restricting <code>series.modelspan</code> is the easiest way and leads to good results.</p>
<p>In some situations you may not be able to restrict the model span. For example if the seasonal break too close to the end of the series or if there is a policy restricting it. In this case, modelling the seasonal break using seasonal regressors may be an option. We apply this technique in the following Case study.</p>
</section><section id="case-study-azerbaijani-budget-expenditures" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="case-study-azerbaijani-budget-expenditures">
<span class="header-section-number">11.5</span> Case Study: Azerbaijani Budget Expenditures</h2>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cbar.sa</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'cbar.sa'</span></span>
<span><span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     m1</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:seasonal':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cpi</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.seasonal.website">seasonal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tsbox/">tsbox</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># visually not obious seasonal break</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_plot.html">ts_plot</a></span><span class="op">(</span><span class="va">budg_exp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># month plot of detrended series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/monthplot.html">monthplot</a></span><span class="op">(</span><span class="va">budg_exp</span> <span class="op">-</span> <span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_trend.html">ts_trend</a></span><span class="op">(</span><span class="va">budg_exp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">budg_exp</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"const"</span>, <span class="st">"ao2017.4"</span>, <span class="st">"seasonal/2016.1/"</span><span class="op">)</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(2 0 0)(1 0 1)"</span>,</span>
<span>  regression.aictest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; seas(x = budg_exp, transform.function = "log", regression.aictest = NULL, </span></span>
<span><span class="co">#&gt;     outlier = NULL, x11 = "", regression.variables = c("const", </span></span>
<span><span class="co">#&gt;         "ao2017.4", "seasonal/2016.1/"), arima.model = "(2 0 0)(1 0 1)")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Constant           8.338851   0.390244  21.368  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; AO2017.4          -0.336074   0.132358  -2.539 0.011113 *  </span></span>
<span><span class="co">#&gt; 1st               -0.217537   0.038891  -5.594 2.22e-08 ***</span></span>
<span><span class="co">#&gt; 2nd               -0.042023   0.039121  -1.074 0.282732    </span></span>
<span><span class="co">#&gt; 3rd               -0.035355   0.040778  -0.867 0.385942    </span></span>
<span><span class="co">#&gt; 1st I             -0.002449   0.054689  -0.045 0.964286    </span></span>
<span><span class="co">#&gt; 2nd I             -0.016296   0.054168  -0.301 0.763535    </span></span>
<span><span class="co">#&gt; 3rd I             -0.075518   0.055309  -1.365 0.172135    </span></span>
<span><span class="co">#&gt; AR-Nonseasonal-01  0.545723   0.111017   4.916 8.85e-07 ***</span></span>
<span><span class="co">#&gt; AR-Nonseasonal-02  0.417009   0.113237   3.683 0.000231 ***</span></span>
<span><span class="co">#&gt; AR-Seasonal-04    -0.152188   0.354758  -0.429 0.667930    </span></span>
<span><span class="co">#&gt; MA-Seasonal-04    -0.278102   0.373339  -0.745 0.456329    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; X11 adj.  ARIMA: (2 0 0)(1 0 1)  Obs.: 62  Transform: log</span></span>
<span><span class="co">#&gt; AICc:  1022, BIC:  1042  QS (no seasonality in final):    0  </span></span>
<span><span class="co">#&gt; Box-Ljung (no autocorr.): 30.17   Shapiro (normality): 0.9883</span></span>
<span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">budg_exp</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  series.modelspan <span class="op">=</span> <span class="st">"2016.1,"</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"const"</span>, <span class="st">"ao2017.4"</span><span class="op">)</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(2 0 0)(1 1 1)"</span>,</span>
<span>  regression.aictest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html">seas</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">budg_exp</span>,</span>
<span>  x11 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  regression.variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"const"</span>, <span class="st">"ao2017.4"</span>, <span class="st">"seasonal/2016.1//"</span><span class="op">)</span>,</span>
<span>  arima.model <span class="op">=</span> <span class="st">"(2 0 0)(1 1 1)"</span>,</span>
<span>  regression.aictest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outlier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform.function <span class="op">=</span> <span class="st">"log"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="864"></p>
</div>
<div class="cell-output-display">
<p><img src="34-seasonal-breaks_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="864"></p>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./33-outliers.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Outliers</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./40-part-other-issues.html" class="pagination-link">
        <span class="nav-page-text">Other Issues</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">by James Livsey and Christoph Sax</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Seasonal Adjustment in R</div>
  </div>
</footer>


</body></html>